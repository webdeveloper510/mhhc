window.gvDTResponsive=window.gvDTResponsive||{},window.gvDTFixedHeaderColumns=window.gvDTFixedHeaderColumns||{},function($){$.fn.dataTable.ext.errMode="throw";var gvDataTables={tablesData:{},setUpFieldFilters:function(datatable,settings){var delayed_search,field_filters_location=datatable.init().field_filters;field_filters_location&&!$(datatable.columns().header()).find(".gv-dt-field-filter").length&&(delayed_search=$.fn.dataTable.util.throttle(function(table,val){table.search(val,!1,!1).draw()},200),datatable.columns().every(function(index){var column=settings.aoColumns[index],that=this;if(column.searchable){if("select"===column.atts.type&&column.atts.options){var input=$("<select></select>").append($("<option>").val("").text(column.atts.placeholder||""));try{options=JSON.parse(column.atts.options)}catch(e){return void console.log(e)}$.each(options,function(d,j){input.append($("<option>").val($("<div />").html(j.value).text()).text(j.text||j.label))})}else input=$("<input/>").attr("type",column.atts.type).attr("placeholder",column.atts.placeholder).attr("min",column.atts.min||null).attr("max",column.atts.max||null).attr("step",column.atts.step||null);var options=settings.oSavedState?settings.oSavedState.columns[index].search.search:"";input.val(options),$(input).attr("class",column.atts.class).attr("data-uid",column.atts.uid).on("click",function(e){e.stopPropagation()}).on("keydown",function(e){(e.metaKey||e.ctrlKey)&&(gvDataTables.cmdOrCtrlPressed="keydown")}).on("keyup",function(e){gvDataTables.cmdOrCtrlPressed=!1}).on("keydown keyup",function(e){return 13===(e.keyCode||e.which)?(e.preventDefault(),!1):("a"===e.key&&gvDataTables.cmdOrCtrlPressed&&$(this)[0].select(),!0)}).on("keyup.DT input.DT paste.DT cut.DT change.DT clear",function(e){var e=e.keyCode||e.which,is_function_keys=e<130&&112<e;if(-1!==[13,16,17,18,33,34,35,36,37,38,39,40,91,93].indexOf(e)||is_function_keys)return!0;$(this).parents("table.gv-datatables").find(".gv-dt-field-filter[data-uid="+$(this).data("uid")+"]").val(this.value),that.search()!==this.value&&delayed_search(that,this.value)}),"both"===field_filters_location?$(input).appendTo($(that.footer()).empty()).clone(!0).appendTo($(that.header())):"header"===field_filters_location?$(input).appendTo($(that.header())):$(input).appendTo($(that.footer()).empty())}}))},init:function(){$(".gv-datatables").each(function(i,e){var options=window.gvDTglobals[i],viewId=$(this).attr("data-viewid"),table=(gvDataTables.tablesData[viewId]=options.ajax.data,options.buttons=gvDataTables.setButtons(options),options.drawCallback=function(data){window.gvEntryNotes&&window.gvEntryNotes.init(),data.json.inlineEditTemplatesData&&$(window).trigger("gravityview-inline-edit/extend-template-data",data.json.inlineEditTemplatesData),$(window).trigger("gravityview-inline-edit/init")},options.initComplete=function(settings){gvDataTables.setUpFieldFilters(this.api(),settings)},options.ajax.data=function(e){return $.extend({},e,gvDataTables.tablesData[viewId])},i<gvDTFixedHeaderColumns.length&&gvDTFixedHeaderColumns.hasOwnProperty(i)&&("1"===gvDTFixedHeaderColumns[i].fixedheader.toString()&&(options.fixedHeader={headerOffset:$("#wpadminbar").outerHeight()}),"1"===gvDTFixedHeaderColumns[i].fixedcolumns.toString())&&(options.fixedColumns=!0),i<gvDTResponsive.length&&gvDTResponsive.hasOwnProperty(i)&&"1"===gvDTResponsive[i].responsive.toString()&&("1"===gvDTResponsive[i].hide_empty.toString()?options.responsive={details:{renderer:gvDataTables.customResponsiveRowRenderer}}:(options.responsive=!0,options.fixedColumns=!1)),options.rowGroupSettings&&options.rowGroupSettings.status&&1==+options.rowGroupSettings.status&&(!(options.fixedColumns=!(i={dataSrc:function(row){row=row[+options.rowGroupSettings.index];return void 0!==$(row).attr("href")?$(row).text():row},startRender:null,endRender:null}))===options.rowGroupSettings.startRender&&(i.startRender=function(rows,group){return group}),!0===options.rowGroupSettings.endRender&&(i.endRender=function(rows,group){return group}),options.rowGroup=i),$(this).DataTable(options));options.updateInterval&&0<options.updateInterval&&setInterval(function(){table.ajax.reload()},+options.updateInterval),table.on("draw.dt",function(e,settings){var api=new $.fn.dataTable.Api(settings),viewId=(api.column(0).data().length&&$(e.target).parents(".gv-container-no-results").removeClass("gv-container-no-results").siblings(".gv-widgets-no-results").removeClass("gv-widgets-no-results"),$(e.target).data("viewid")),tableData=gvDataTables.tablesData&&viewId?gvDataTables.tablesData[viewId]:null,viewId=tableData&&tableData.hasOwnProperty("getData")?tableData.getData:null;if(0!==api.data().length||0!==api.search().length||0!==api.columns().search().filter(function(string){return""!==string}).length||viewId)$(e.target).find(".dataTables_empty").text(options.language.emptyTable);else switch($(e.target).find(".dataTables_empty").text(options.language.zeroRecords),tableData&&tableData.hasOwnProperty("noEntriesOption")?+tableData.noEntriesOption:null){case 1:($container=$(e.target).parents("div[id^=gv-view-]")).find("[id^=gv-datatables-],.gv-widgets-header,.gv-powered-by").hide().end().find(".gv-datatables-form-container").removeClass("gv-hidden");break;case 2:var redirectURL=tableData&&tableData.hasOwnProperty("redirectURL")?tableData.redirectURL:null;redirectURL.length&&(window.location=redirectURL);break;case 3:$(e.target).parents(".gv-datatables-container").hide()}$(window).trigger("gravityview-datatables/event/draw",{e:e,settings:settings})}).on("preXhr.dt",function(e,settings,data){$(window).trigger("gravityview-datatables/event/preXhr",{e:e,settings:settings,data:data})}).on("processing.dt",function(e,settings,processing){processing&&gvDataTables.repositionLoader($(e.target))}).on("xhr.dt",function(e,settings,json,xhr){$(window).trigger("gravityview-datatables/event/xhr",{e:e,settings:settings,json:json,xhr:xhr})}).on("responsive-resize",function(e,datatable,columns){gvDataTables.setUpFieldFilters(datatable,datatable.settings()[0])}).on("responsive-display",function(e,datatable,row,showHide,update){var visible_divs,div_attr;$(window).trigger("gravityview-datatables/event/responsive"),0<(visible_divs=$(this).find("td:visible .gravityview-fancybox")).length&&visible_divs.each(function(i,e){(div_attr=$(this).attr("data-fancybox"))&&-1===div_attr.indexOf("mobile")&&(div_attr+="-mobile",$(this).attr("data-fancybox",div_attr))})})})},repositionLoader:function($table){var topPosition,$container=$table.parents(".gv-datatables-container"),$thead=$table.find("thead"),$tbody=$table.find("tbody"),$tfoot=$table.find("tfoot"),$loader=$("div.dataTables_processing",$container),tbodyTop=($.fn.isInViewport=function(){var elementTop=$(this).offset().top,elementBottom=elementTop+$(this).outerHeight(),viewportTop=$(window).scrollTop(),viewportBottom=viewportTop+$(window).height();return viewportTop<=elementTop&&elementBottom<=viewportBottom},$tbody.position().top),theadHeight=$thead.outerHeight(),scrollTop=$(window).scrollTop(),containerTop=$container.offset().top,windowHeight=window.innerHeight||document.documentElement.clientHeight,loaderHeight=$loader.outerHeight(),adjustedViewportTop=scrollTop-containerTop+theadHeight,adjustedViewportBottom=scrollTop+windowHeight-containerTop-loaderHeight,viewportTop=Math.max(0,scrollTop-containerTop),$container=Math.min($container.outerHeight(),scrollTop+windowHeight-containerTop),scrollTop=Math.min($container-loaderHeight,Math.max(viewportTop,tbodyTop+theadHeight)),windowHeight=$table.isInViewport();windowHeight&&$tbody.height()>$loader.height()?topPosition="50%":windowHeight?topPosition=scrollTop:$tfoot.isInViewport()?topPosition=($tfoot.position().top-adjustedViewportTop)/2+adjustedViewportTop:$thead.isInViewport()&&(topPosition=(adjustedViewportBottom-scrollTop)/2+scrollTop),$loader.css({position:"absolute",top:topPosition})},setButtons:function(options){var buttons=[];return options&&options.buttons&&0<options.buttons.length&&options.buttons.forEach(function(button,i){"print"===button.extend?buttons[i]=$.extend(!0,{},gvDataTables.buttonCommon,gvDataTables.buttonCustomizePrint,button):buttons[i]=$.extend(!0,{},gvDataTables.buttonCommon,button)}),buttons},buttonCommon:{exportOptions:{format:{body:function(data,column,row){return 0!==data.length&&(data=data.replace(/\n/g," "),data=$("<span>"+data+"</span>").find("li").after("; ").end().find("img").replaceWith(function(){return $(this).attr("alt")}).end().find(".dashicons.dashicons-yes").replaceWith(function(){return"&#10004;"}).end().find("br").replaceWith(" ").end().find(".map-it-link").remove().end().text()),data}}}},buttonCustomizePrint:{customize:function(win){$(win.document.body).find("table").addClass("compact").css("font-size","inherit").css("table-layout","auto")}},customResponsiveRowRenderer:function(api,rowIdx){var data=api.cells(rowIdx,":hidden").eq(0).map(function(cell){var idx,header=$(api.column(cell.column).header());return header.hasClass("control")||header.hasClass("never")||(idx=api.cell(cell).index(),0===api.cell(cell).data().length)?"":(cell=(cell=api.settings()[0]).oApi._fnGetCellData(cell,idx.row,idx.column,"display"),'<li data-dtr-index="'+idx.column+'"><span class="dtr-title">'+header.find(".gv-dt-field-filter").remove().end().text()+':</span> <span class="dtr-data">'+cell+"</span></li>")}).toArray().join("");return!!data&&$('<ul data-dtr-index="'+rowIdx+'"/>').append(data)}};$(document).ready(function(){gvDataTables.init(),$(".gv-search-clear").off().on("click",function(e){var $form=$(this).parents("form"),viewId=$form.attr("data-viewid"),tableId=$("#gv-datatables-"+viewId).find(".dataTable").attr("id"),tableData=gvDataTables.tablesData?gvDataTables.tablesData[viewId]:null,isSearch=$form.hasClass("gv-is-search");if(tableId&&$.fn.DataTable.isDataTable("#"+tableId)){e.preventDefault(),e.stopImmediatePropagation();e=$("#"+tableId).DataTable();if(isSearch&&$form.serialize()!==$form.attr("data-state")){for(var formData={},serializedData=$form.attr("data-state").split("&"),i=0;i<serializedData.length;i++){var item=serializedData[i].split("=");formData[decodeURIComponent(item[0])]=decodeURIComponent(item[1])}$.each(formData,function(name,value){$form.find('[name="'+name+'"]').val(value)}),$(".gv-search-clear",$form).text(gvGlobals.clear)}else $('input[type="search"], input:text, input:password, input:file, select, textarea',$form).val(""),$("input:checkbox, input:radio",$form).removeAttr("checked").removeAttr("selected"),$form.serialize()!==$form.attr("data-state")&&(tableData.getData=!1,gvDataTables.tablesData[viewId]=tableData,window.history.pushState(null,null,window.location.pathname),$form.removeClass("gv-is-search"),$form.attr("data-state",$form.serialize()),e.ajax.reload()),$(this).hide(100)}}),$(".gv-widget-search").on("submit",function(e){e.preventDefault();var getData={},e=$(this).attr("data-viewid"),$container=$("#gv-datatables-"+e),$table=(0<$container.find(".DTFC_ScrollWrapper").length?$container.find(".dataTables_scrollBody .gv-datatables"):$container.find(".gv-datatables")).DataTable(),tableData=gvDataTables.tablesData?gvDataTables.tablesData[e]:null,inputs=$(this).serializeArray().filter(function(k){return""!==$.trim(k.value)});if($(this).serialize()!==$(this).attr("data-state"))if($(this).attr("data-state",$(this).serialize()),tableData){+tableData.hideUntilSearched&&$container.toggleClass("hidden gv-hidden",inputs.length<=1);for(var i=0;i<inputs.length;i++){var name=inputs[i].name,value=inputs[i].value,matches=name.match(/(.*?)\[(.*)\]/);matches?(getData[matches[1]]||(matches[2]?getData[matches[1]]={}:getData[matches[1]]=[]),matches[2]?getData[matches[1]][matches[2]]=value:getData[matches[1]].push(value)):getData[name]=value}tableData.search={value:""},tableData.getData=1<Object.keys(getData).length&&JSON.stringify(getData),tableData.setUrlOnSearch&&window.history.pushState(null,null,tableData.getData?"?"+$(this).serialize():window.location.pathname),gvDataTables.tablesData[e]=tableData,$table.ajax.reload(),$(this).addClass("gv-is-search").attr("data-state",$(this).serialize()).trigger("keyup"),$(".gv-search-clear",$(this)).text(gvGlobals.clear)}else this.submit()})})}(jQuery);