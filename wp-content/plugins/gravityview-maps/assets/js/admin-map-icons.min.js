window.gravitykit=window.gravitykit||{},window.gravitykit.maps=window.gravitykit.maps||{},window.gravitykit.maps.adminMapIcons=window.gravitykit.maps.adminMapIcons||{},function($,obj){"use strict";"undefined"!=typeof gform&&(obj.i18n=window.gravitykit_maps_admin_map_icons_data,obj.getChoicesAdminRowHTML=(index=0,icon="",icon_id="")=>`
			<button type="button" id="gk-gravitymaps-custom-icon-option-upload-button-${index}" class="button gk-gravitymaps-custom-icon-option-upload-button" title="${obj.i18n.uploadIcon}">
				<i class="dashicons dashicons-format-image"></i>
			</button>
			<span id="gk-gravitymaps-custom-icon-option-preview-${index}" class="gk-gravitymaps-custom-icon-option-preview-wrap">
				<span class="gk-gravitymaps-custom-icon-option-preview" style="background-image:url(${icon});"></span>
				<a class="gk-gravitymaps-custom-icon-option-icon-remove" title="${obj.i18n.removeImage}"><i class="dashicons dashicons-no"></i></a>
			</span>
			<input type="hidden" id="gk-gravitymaps-custom-icon-option-icon-${index}" class="gk-gravitymaps-custom-icon-option-icon" value="${icon}" />
			<input type="hidden" id="gk-gravitymaps-custom-icon-option-icon-id-${index}" class="gk-gravitymaps-custom-icon-option-icon-id" value="${icon_id}" />`,obj.onClickUploadButton=event=>{obj.openMediaLibrary($(event.target),event.data.$settings)},obj.onClickRemoveIcon=event=>{event.preventDefault(),obj.removePreview($(event.target))},obj.getChoices=function(field,$settings){void 0===field&&(field=GetSelectedField()),obj.fieldCanHaveIcons(field)&&($settings=void 0===$settings?obj.getSettingsElement():$settings).find(".field-choice-row").each(function(){var $row=$(this),index=$row.data("index"),icon=field.choices.length&&void 0!==field.choices[index].gk_custom_map_icon?field.choices[index].gk_custom_map_icon:"",icon_id=field.choices.length&&void 0!==field.choices[index].gk_custom_map_icon_id?field.choices[index].gk_custom_map_icon_id:"";$row.find(".gk-gravitymaps-custom-icon-option-icon").length||$row.find(".field-choice-text").before(obj.getChoicesAdminRowHTML(index,icon,icon_id)),$row.find(".gk-gravitymaps-custom-icon-option-upload-button").on({click:obj.onClickUploadButton},null,{$settings:$settings}),$row.find(".gk-gravitymaps-custom-icon-option-icon-remove").on("click",obj.onClickRemoveIcon),""!==$row.find(".gk-gravitymaps-custom-icon-option-icon").val()&&$row.addClass("gk-gravitymaps-custom-icon-has-icon")})},obj.removePreview=btnEl=>{void 0!==btnEl&&((btnEl=$(btnEl).closest('[class*="-choice-row"]')).find(".gk-gravitymaps-custom-icon-option-icon").val(""),btnEl.find(".gk-gravitymaps-custom-icon-option-icon-id").val(""),btnEl.find(".gk-gravitymaps-custom-icon-option-preview").css("background-image",""),btnEl.removeClass("gk-gravitymaps-custom-icon-has-icon"),obj.updateFieldChoicesObject())},obj.updateFieldChoicesObject=()=>{const field=GetSelectedField();obj.getSettingsElement().find('[class*="-choice-row"]').each(function(index){var $choice=$(this),icon=$choice.find(".gk-gravitymaps-custom-icon-option-icon").val(),icon_id=$choice.find(".gk-gravitymaps-custom-icon-option-icon-id").val(),i=$choice.data("index");""!==icon?($choice.addClass("gk-gravitymaps-custom-icon-has-icon"),$choice.find(".gk-gravitymaps-custom-icon-option-preview").css("background-image","url("+icon+")")):$choice.removeClass("gk-gravitymaps-custom-icon-has-icon"),field.choices[i].gk_custom_map_icon=icon,field.choices[i].gk_custom_map_icon_id=icon_id})},obj.getFieldElement=()=>{var field=GetSelectedField();return $("#field_"+field.id)},obj.toggleEnableIcons=enable=>{var $settings=obj.getSettingsElement(),$toggle=$settings.find("input.gk_gravitymaps_choice_marker_icons_enabled"),$field=(void 0===enable&&(enable=$toggle.is(":checked")),obj.getFieldElement());SetFieldProperty("gk_custom_map_icon_enabled",enable),$toggle.prop("checked",enable),$("#gfield_settings_choices_container").toggleClass("gk-gravitymaps-custom-icon-enabled",enable),$field.toggleClass("gk-gravitymaps-custom-icon-use-icons",enable),$settings.toggleClass("gk-gravitymaps-custom-icon-use-icons",enable)},obj.modifyWPMediaModal=()=>{$("button.media-button-insert, button.media-button-select").text(obj.i18n.useIcon)},obj.openMediaLibrary=(btnEl,$settings)=>{if(void 0!==btnEl){const $choice=$(btnEl).closest('[class*="-choice-row"]');let fileFrame=$choice.data("file-frame");fileFrame?fileFrame.open():(fileFrame=wp.media({title:"Select an icon to upload",button:{text:"Use this icon"},frame:"post",state:"insert",multiple:!1}),setTimeout(obj.modifyWPMediaModal,100),fileFrame.on("insert",selection=>{var state=fileFrame.state();if(selection=selection||state.get("selection")){let attachment=selection.first();selection=state.display(attachment).toJSON(),state=(attachment=attachment.toJSON()).sizes[selection.size].url;$choice.find(".gk-gravitymaps-custom-icon-option-icon").val(state),$choice.find(".gk-gravitymaps-custom-icon-option-icon-id").val(attachment.id),$choice.find(".gk-gravitymaps-custom-icon-option-preview").css("background-image",`url('${state}')`),$choice.addClass("gk-gravitymaps-custom-icon-has-icon"),obj.updateFieldChoicesObject(),$settings.find('[data-js="choices-ui-trigger"]').trigger("click")}}),fileFrame.open(),$choice.data("file-frame",fileFrame))}},obj.fieldCanHaveIcons=field=>{return!(void 0===field||!field.hasOwnProperty("type"))&&-1!==["select","radio"].indexOf(field.type)},obj.getSettingsElement=()=>$("#field_settings_container, #choices-ui-flyout"),obj.onFieldLoadSettings=(event,field,form)=>{obj.unbindEvents(field),obj.includeSettings(field),obj.fieldCanHaveIcons(field)&&obj.bindEvents(field)},obj.onFieldChoicesLoad=fields=>{fields=void 0!==fields&&fields.length?fields[0]:GetSelectedField();obj.unbindEvents(fields),obj.includeSettings(fields),obj.fieldCanHaveIcons(fields)&&obj.bindEvents(fields)},obj.includeSettings=field=>{var $field=$("#field_"+field.id),$fieldSettings=obj.getSettingsElement();obj.fieldCanHaveIcons(field)?($field.addClass("gk-gravitymaps-custom-icon-admin-field"),$fieldSettings.addClass("gk-gravitymaps-custom-icon-field-settings"),obj.toggleEnableIcons(!0===field.gk_custom_map_icon_enabled)):($field.removeClass("gk-gravitymaps-custom-icon-admin-field"),$fieldSettings.removeClass("gk-gravitymaps-custom-icon-field-settings"),obj.toggleEnableIcons(!1)),obj.getChoices(field)},obj.bindEvents=field=>{const $fieldSettings=obj.getSettingsElement();$fieldSettings.find('[data-js="choices-ui-trigger"]').on("click.gkMapsIcons",event=>{var $choicesFlyout=$('[data-js="choices-ui-flyout"]:visible');obj.fieldCanHaveIcons(field)&&($choicesFlyout.addClass("gk-gravitymaps-custom-icon-admin-field"),$fieldSettings.addClass("gk-gravitymaps-custom-icon-field-settings"),obj.toggleEnableIcons(!0===field.gk_custom_map_icon_enabled),obj.getChoices(field,$choicesFlyout))}),$(".gk_gravitymaps_choice_marker_icons_enabled").on("change.gkMapsIcons",event=>{event=$(event.target);obj.toggleEnableIcons(event.is(":checked"))})},obj.unbindEvents=field=>{obj.getSettingsElement().find('[data-js="choices-ui-trigger"]').off("click.gkMapsIcons"),$(".gk_gravitymaps_choice_marker_icons_enabled").off("change.gkMapsIcons")},gform.addAction("gform_load_field_choices",obj.onFieldChoicesLoad),$(document).on("gform_load_field_settings",obj.onFieldLoadSettings),$(document).ready(()=>{$("body").on("click","li.attachment, .media-menu-item",obj.modifyWPMediaModal)}))}(jQuery,window.gravitykit.maps.adminMapIcons);