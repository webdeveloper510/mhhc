(($,obj,GravityMaps)=>{"use strict";(GravityMaps.searchAddressAutocomplete=obj).className=value=>"string"!=typeof value&&!this instanceof String||"function"!=typeof value.replace?value:value.replace(".",""),obj.selectors={fields:"[data-js-gk-autocomplete]",searchBox:".gv-search-box",searchWidget:".gv-widget-search",defaultLatField:".gk-maps-search-geolocation-lat",defaultLngField:".gk-maps-search-geolocation-lng",hiddenAddressSearch:'input[type="hidden"][name="address_search"], input[type="hidden"][disabled-name="address_search"]'},obj.$fields=null,obj.hooks=GravityMaps.hooks,obj.ready=()=>{obj.initAutoComplete()},obj.initAutoComplete=()=>{obj.$fields=$(obj.selectors.fields),obj.$fields.each((index,element)=>{element=$(element);obj.initField(element,{})})},obj.initField=($field,options)=>{obj.hooks.doAction("gravitykit/maps/view_search/autocomplete_init",$field);options=$.extend({},{fields:["address_components","geometry"],strictBounds:!1},options);options=new google.maps.places.Autocomplete($field[0],options);$field.data("gkAutocomplete",options),options.addListener("place_changed",()=>obj.onPlaceSelection($field)),$field.on("keydown",event=>{13===event.keyCode&&event.preventDefault()}).on("change",()=>{obj.getDefaultFieldCallbacks();$field.data("gkAutoCompletePreventClear",0),obj.toggleGeolocationFields($field,""!=$field.val()),obj.repopulateSearchWidgetState($field)}).on("focusin",event=>{$field.one("focusout",event=>{var fields;$field.data("gkAutoCompletePreventClear")||(fields=obj.getDefaultFieldCallbacks(),$field.val(""),$field.data("gkAutoCompletePreventClear",0),fields.lat($field).val(""),fields.lng($field).val(""),fields.hiddenAddressSearch($field).val(""),obj.repopulateSearchWidgetState($field))})})},obj.toggleGeolocationFields=($field,toggleTo)=>{$field=obj.getSearchWidget($field);let $fields=$field.find(".gk-search-geolocation-field").find("[name], [disabled-name]");return($fields=$fields.add($field.find('[name="address_search"], [name="long"], [name="lat"], [disabled-name="address_search"], [disabled-name="long"], [disabled-name="lat"]'))).each((index,field)=>{field=$(field);toggleTo?field.attr("name",field.attr("disabled-name")).attr("disabled-name",null):field.attr("disabled-name",field.attr("name")).attr("name",null)})},obj.repopulateSearchWidgetState=$field=>{$field=obj.getSearchWidget($field);return $field.attr("data-state",$field.serialize())},obj.getSearchWidget=$field=>$field.parents(obj.selectors.searchWidget).eq(0),obj.getDefaultFieldCallbacks=()=>({lat:$field=>$field.parents(obj.selectors.searchBox).eq(0).find(obj.selectors.defaultLatField),lng:$field=>$field.parents(obj.selectors.searchBox).eq(0).find(obj.selectors.defaultLngField),hiddenAddressSearch:$field=>obj.getSearchWidget($field).find(obj.selectors.hiddenAddressSearch)}),obj.onPlaceSelection=($field,fields)=>{var autocomplete=$field.data("gkAutocomplete");if(void 0!==autocomplete){fields=$.extend(fields,obj.getDefaultFieldCallbacks()),void 0!==window.GravityKit.GravityMaps.searchFields&&window.GravityKit.GravityMaps.searchFields.resetCurrentLocation($field);autocomplete=autocomplete.getPlace();let address1="",postcode="";for(const component of autocomplete.address_components)switch(component.types[0]){case"street_number":address1=component.long_name+" "+address1;break;case"route":address1+=component.short_name;break;case"postal_code":postcode=""+component.long_name+postcode;break;case"postal_code_suffix":postcode=postcode+"-"+component.long_name}$field.data("gkAutoCompletePreventClear",1),fields.lat($field).val(autocomplete.geometry.location.lat()),fields.lng($field).val(autocomplete.geometry.location.lng()),fields.hiddenAddressSearch($field).remove(),$field.trigger("focus"),obj.toggleGeolocationFields($field,!0),obj.repopulateSearchWidgetState($field)}},$(document).ready(obj.ready)})(window.jQuery,{},window.GravityKit.GravityMaps);